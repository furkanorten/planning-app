<div class="tasks-container">
  <!-- Header -->
  <header class="tasks-header">
    <div class="header-content">
      <h1>Tasks</h1>
      <button class="btn btn-primary" (click)="openTaskForm()" [disabled]="loadingAction">
        <lucide-icon name="plus" size="16"></lucide-icon>
        Add Task
      </button>
    </div>
  </header>

  <!-- Stats Overview -->
  <app-task-stats [stats]="stats" [loading]="loading"></app-task-stats>

  <!-- Quick Filters -->
  <div class="quick-filters">
    <button
      class="filter-btn"
      [class.active]="currentFilters.completed === undefined"
      (click)="showAllTasks()">
      All Tasks ({{ stats.totalTasks }})
    </button>
    <button
      class="filter-btn"
      [class.active]="currentFilters.completed === false"
      (click)="showActiveTasks()">
      Active ({{ stats.totalTasks - stats.completedTasks }})
    </button>
    <button
      class="filter-btn"
      [class.active]="currentFilters.completed === true"
      (click)="showCompletedTasks()">
      Completed ({{ stats.completedTasks }})
    </button>
  </div>

  <!-- Filters & Search -->
  <app-task-filters
    [filters]="currentFilters"
    (filtersChange)="onFiltersChange($event)">
  </app-task-filters>

  <!-- Tasks List -->
  <div class="tasks-content">
    <div class="tasks-controls">
      <div class="sort-controls">
        <label>Sort by:</label>
        <select [(ngModel)]="currentFilters.sortBy" (change)="onSortChange(currentFilters.sortBy!)">
          <option value="createdAt">Created Date</option>
          <option value="updatedAt">Updated Date</option>
          <option value="deadline">Deadline</option>
          <option value="title">Title</option>
          <option value="priority">Priority</option>
        </select>
        <button
          class="sort-order-btn"
          (click)="onSortChange(currentFilters.sortBy!)"
          [title]="currentFilters.sortOrder === 'asc' ? 'Sort Descending' : 'Sort Ascending'">
          <lucide-icon
            [name]="currentFilters.sortOrder === 'asc' ? 'arrow-up' : 'arrow-down'"
            size="16">
          </lucide-icon>
        </button>
      </div>

      <div class="results-info">
        <span>{{ totalCount }} tasks found</span>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="loading">
      <div class="loading-spinner"></div>
      <p>Loading tasks...</p>
    </div>

    <!-- Tasks List -->
    <div class="tasks-list" *ngIf="!loading">
      <!-- Empty State -->
      <div class="empty-state" *ngIf="tasks.length === 0">
        <lucide-icon name="check-square" size="48" class="empty-icon"></lucide-icon>
        <h3>No tasks found</h3>
        <p *ngIf="currentFilters.completed === undefined">
          Start by creating your first task to stay organized and productive.
        </p>
        <p *ngIf="currentFilters.completed === false">
          All tasks are completed! Great job! ðŸŽ‰
        </p>
        <p *ngIf="currentFilters.completed === true">
          No completed tasks yet. Complete some tasks to see them here.
        </p>
        <button class="btn btn-primary" (click)="openTaskForm()" *ngIf="currentFilters.completed !== true">
          <lucide-icon name="plus" size="16"></lucide-icon>
          Create First Task
        </button>
      </div>

      <!-- Task Items -->
      <div class="task-items" *ngIf="tasks.length > 0">
        <app-task-item
          *ngFor="let task of tasks; trackBy: trackByTaskId"
          [task]="task"
          [loading]="loadingAction"
          (toggle)="onToggleTask($event)"
          (edit)="editTask($event)"
          (delete)="onDeleteTask($event)">
        </app-task-item>
      </div>

      <!-- Pagination -->
      <div class="pagination" *ngIf="totalPages > 1">
        <button
          class="pagination-btn"
          [disabled]="currentFilters.page === 1"
          (click)="onPageChange(currentFilters.page! - 1)">
          <lucide-icon name="chevron-left" size="16"></lucide-icon>
          Previous
        </button>

        <span class="pagination-info">
          Page {{ currentFilters.page }} of {{ totalPages }}
        </span>

        <button
          class="pagination-btn"
          [disabled]="currentFilters.page === totalPages"
          (click)="onPageChange(currentFilters.page! + 1)">
          Next
          <lucide-icon name="chevron-right" size="16"></lucide-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Task Form Modal -->
  <div class="modal-overlay" *ngIf="showTaskForm" (click)="closeTaskForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ editingTask ? 'Edit Task' : 'Create New Task' }}</h2>
        <button class="close-btn" (click)="closeTaskForm()">
          <lucide-icon name="x" size="20"></lucide-icon>
        </button>
      </div>
      <app-task-form
        [task]="editingTask"
        [loading]="loadingAction"
        (save)="onTaskFormSave($event)"
        (cancel)="closeTaskForm()">
      </app-task-form>
    </div>
  </div>
</div>
