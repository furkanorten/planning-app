<div class="task-filters" [formGroup]="filtersForm">

  <!-- Quick Actions Bar -->
  <div class="quick-actions">
    <div class="preset-filters">
      <button type="button" class="preset-btn overdue" (click)="showOverdueTasks()">
        <lucide-icon name="alert-triangle" size="14"></lucide-icon>
        Overdue
      </button>
      <button type="button" class="preset-btn due-today" (click)="showDueTodayTasks()">
        <lucide-icon name="calendar" size="14"></lucide-icon>
        Due Today
      </button>
      <button type="button" class="preset-btn high-priority" (click)="showHighPriorityTasks()">
        <lucide-icon name="zap" size="14"></lucide-icon>
        High Priority
      </button>
      <button type="button" class="preset-btn recent" (click)="showRecentTasks()">
        <lucide-icon name="clock" size="14"></lucide-icon>
        Recent
      </button>
    </div>

    <div class="filter-actions">
      <button
        type="button"
        class="action-btn advanced"
        (click)="toggleAdvancedFilters()"
        [class.active]="showAdvancedFilters">
        <lucide-icon name="sliders" size="14"></lucide-icon>
        Advanced
        <lucide-icon
          [name]="showAdvancedFilters ? 'chevron-up' : 'chevron-down'"
          size="14">
        </lucide-icon>
      </button>

      <button
        type="button"
        class="action-btn clear"
        (click)="clearAllFilters()"
        [disabled]="!hasActiveFilters"
        [title]="getClearButtonTitle()">
        <lucide-icon name="x" size="14"></lucide-icon>
        {{ getClearButtonText() }}
        <span class="filter-count" *ngIf="activeFilterCount > 0">
          {{ activeFilterCount }}
        </span>
      </button>
    </div>
  </div>

  <!-- Basic Filters -->
  <div class="basic-filters">
    <!-- Search -->
    <div class="filter-group search-group">
      <div class="search-input-wrapper">
        <lucide-icon name="search" size="16" class="search-icon"></lucide-icon>
        <input
          type="text"
          class="search-input"
          formControlName="search"
          placeholder="Search tasks..."
          maxlength="100">
        <button
          type="button"
          class="clear-search"
          *ngIf="filtersForm.get('search')?.value"
          (click)="clearSearch()">
          <lucide-icon name="x" size="14"></lucide-icon>
        </button>
      </div>
    </div>

    <!-- Completion Status -->
    <div class="filter-group">
      <label class="filter-label">Status</label>
      <select class="filter-select" formControlName="completed">
        <option *ngFor="let option of completionOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
    </div>

    <!-- Category -->
    <div class="filter-group">
      <label class="filter-label">Category</label>
      <select class="filter-select" formControlName="category">
        <option *ngFor="let category of categories" [value]="category.value">
          {{ category.label }}
        </option>
      </select>
      <div class="filter-preview" *ngIf="selectedCategoryInfo && selectedCategoryInfo.value !== 'all'">
        <span class="category-badge" [style.background-color]="selectedCategoryInfo.color">
          {{ selectedCategoryInfo.label }}
        </span>
      </div>
    </div>

    <!-- Priority -->
    <div class="filter-group">
      <label class="filter-label">Priority</label>
      <select class="filter-select" formControlName="priority">
        <option *ngFor="let priority of priorities" [value]="priority.value">
          {{ priority.label }}
        </option>
      </select>
      <div class="filter-preview" *ngIf="selectedPriorityInfo && selectedPriorityInfo.value !== 'all'">
        <span class="priority-badge" [class]="selectedPriorityInfo.value">
          <lucide-icon
            [name]="selectedPriorityInfo.value === 'high' ? 'arrow-up' :
                    selectedPriorityInfo.value === 'low' ? 'arrow-down' : 'minus'"
            size="10">
          </lucide-icon>
          {{ selectedPriorityInfo.label }}
        </span>
      </div>
    </div>
  </div>

  <!-- Advanced Filters -->
  <div class="advanced-filters" *ngIf="showAdvancedFilters" [@slideDown]>
    <div class="advanced-filters-content">

      <!-- Sort Options -->
      <div class="filter-row">
        <div class="filter-group">
          <label class="filter-label">Sort By</label>
          <select class="filter-select" formControlName="sortBy">
            <option *ngFor="let option of sortOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label class="filter-label">Order</label>
          <select class="filter-select" formControlName="sortOrder">
            <option value="desc">Descending</option>
            <option value="asc">Ascending</option>
          </select>
        </div>
      </div>

      <!-- Date Filters -->
      <div class="filter-row">
        <div class="filter-group">
          <label class="filter-label">Due Date From</label>
          <input
            type="date"
            class="filter-input"
            formControlName="start"
            [formGroup]="$any(filtersForm.get('dueDateRange'))">
        </div>

        <div class="filter-group">
          <label class="filter-label">Due Date To</label>
          <input
            type="date"
            class="filter-input"
            formControlName="end"
            [formGroup]="$any(filtersForm.get('dueDateRange'))">
        </div>
      </div>

      <!-- Deadline Options -->
      <div class="filter-row">
        <div class="filter-group">
          <label class="filter-label">Deadline</label>
          <select class="filter-select" formControlName="hasDeadline">
            <option [value]="undefined">All Tasks</option>
            <option [value]="true">With Deadline</option>
            <option [value]="false">No Deadline</option>
          </select>
        </div>

        <div class="filter-group checkbox-group">
          <label class="checkbox-label">
            <input
              type="checkbox"
              formControlName="isOverdue"
              class="filter-checkbox">
            <span class="checkbox-custom">
              <lucide-icon name="check" size="12"></lucide-icon>
            </span>
            <span class="checkbox-text">Show overdue only</span>
          </label>
        </div>
      </div>

    </div>
  </div>

  <!-- Active Filters Summary -->
  <div class="active-filters" *ngIf="hasActiveFilters">
    <span class="active-filters-label">
      <lucide-icon name="filter" size="14"></lucide-icon>
      Active Filters:
    </span>

    <div class="active-filter-tags">
      <span class="filter-tag" *ngIf="filtersForm.get('search')?.value?.trim()">
        <lucide-icon name="search" size="12"></lucide-icon>
        "{{ filtersForm.get('search')?.value }}"
        <button type="button" (click)="filtersForm.patchValue({search: ''})">
          <lucide-icon name="x" size="10"></lucide-icon>
        </button>
      </span>

      <span class="filter-tag" *ngIf="filtersForm.get('completed')?.value !== undefined">
        <lucide-icon name="check-square" size="12"></lucide-icon>
        {{ filtersForm.get('completed')?.value ? 'Completed' : 'Active' }}
        <button type="button" (click)="filtersForm.patchValue({completed: undefined})">
          <lucide-icon name="x" size="10"></lucide-icon>
        </button>
      </span>

      <span class="filter-tag" *ngIf="selectedCategoryInfo && selectedCategoryInfo.value !== 'all'">
        <span class="category-dot" [style.background-color]="selectedCategoryInfo.color"></span>
        {{ selectedCategoryInfo.label }}
        <button type="button" (click)="filtersForm.patchValue({category: 'all'})">
          <lucide-icon name="x" size="10"></lucide-icon>
        </button>
      </span>

      <span class="filter-tag" *ngIf="selectedPriorityInfo && selectedPriorityInfo.value !== 'all'">
        <lucide-icon
          [name]="selectedPriorityInfo.value === 'high' ? 'arrow-up' :
                  selectedPriorityInfo.value === 'low' ? 'arrow-down' : 'minus'"
          size="12">
        </lucide-icon>
        {{ selectedPriorityInfo.label }} Priority
        <button type="button" (click)="filtersForm.patchValue({priority: 'all'})">
          <lucide-icon name="x" size="10"></lucide-icon>
        </button>
      </span>

      <span class="filter-tag" *ngIf="filtersForm.get('isOverdue')?.value">
        <lucide-icon name="alert-triangle" size="12"></lucide-icon>
        Overdue
        <button type="button" (click)="filtersForm.patchValue({isOverdue: false})">
          <lucide-icon name="x" size="10"></lucide-icon>
        </button>
      </span>
    </div>
  </div>
</div>
