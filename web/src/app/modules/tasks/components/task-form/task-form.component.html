<div class="task-form">
  <form [formGroup]="taskForm" (ngSubmit)="onSubmit()" [class.loading]="loading">

    <!-- Title Field -->
    <div class="form-group">
      <label for="title" class="form-label required">
        Task Title
        <span class="char-count">{{ titleCharCount }}/200</span>
      </label>
      <input
        type="text"
        id="title"
        class="form-control"
        formControlName="title"
        placeholder="Enter task title..."
        [class.error]="titleErrors.length > 0"
        maxlength="200">
      <div class="error-messages" *ngIf="titleErrors.length > 0">
        <span *ngFor="let error of titleErrors" class="error-message">
          <lucide-icon name="alert-circle" size="14"></lucide-icon>
          {{ error }}
        </span>
      </div>
    </div>

    <!-- Description Field -->
    <div class="form-group">
      <label for="description" class="form-label">
        Description
        <span class="char-count">{{ descriptionCharCount }}/1000</span>
      </label>
      <textarea
        id="description"
        class="form-control"
        formControlName="description"
        placeholder="Add task description (optional)..."
        rows="3"
        [class.error]="descriptionErrors.length > 0"
        maxlength="1000">
      </textarea>
      <div class="error-messages" *ngIf="descriptionErrors.length > 0">
        <span *ngFor="let error of descriptionErrors" class="error-message">
          <lucide-icon name="alert-circle" size="14"></lucide-icon>
          {{ error }}
        </span>
      </div>
    </div>

    <!-- Category and Priority Row -->
    <div class="form-row">
      <!-- Category Field -->
      <div class="form-group">
        <label for="category" class="form-label required">Category</label>
        <select id="category" class="form-control" formControlName="category">
          <option *ngFor="let category of categories" [value]="category.value">
            {{ category.label }}
          </option>
        </select>
        <div class="category-preview" *ngIf="taskForm.get('category')?.value">
          <span class="category-badge"
                [style.background-color]="getCategoryInfo(taskForm.get('category')?.value)?.color">
            {{ getCategoryInfo(taskForm.get('category')?.value)?.label }}
          </span>
        </div>
      </div>

      <!-- Priority Field -->
      <div class="form-group">
        <label for="priority" class="form-label required">Priority</label>
        <select id="priority" class="form-control" formControlName="priority">
          <option *ngFor="let priority of priorities" [value]="priority.value">
            {{ priority.label }}
          </option>
        </select>
        <div class="priority-preview" *ngIf="taskForm.get('priority')?.value">
          <span class="priority-badge"
                [class]="taskForm.get('priority')?.value">
            <lucide-icon
              [name]="taskForm.get('priority')?.value === 'high' ? 'arrow-up' :
                      taskForm.get('priority')?.value === 'low' ? 'arrow-down' : 'minus'"
              size="12">
            </lucide-icon>
            {{ getPriorityInfo(taskForm.get('priority')?.value)?.label }}
          </span>
        </div>
      </div>
    </div>

    <!-- Deadline Field -->
    <div class="form-group">
      <label for="deadline" class="form-label">
        Deadline
        <span class="optional">(optional)</span>
      </label>
      <div class="deadline-controls">
        <input
          type="datetime-local"
          id="deadline"
          class="form-control"
          formControlName="deadline">

        <!-- Quick Deadline Buttons -->
        <div class="quick-deadline-buttons">
          <button type="button" class="quick-btn" (click)="setDueTomorrow()">
            <lucide-icon name="sunrise" size="14"></lucide-icon>
            Tomorrow
          </button>
          <button type="button" class="quick-btn" (click)="setDueNextWeek()">
            <lucide-icon name="calendar" size="14"></lucide-icon>
            Next Week
          </button>
          <button type="button" class="quick-btn clear" (click)="clearDeadline()">
            <lucide-icon name="x" size="14"></lucide-icon>
            Clear
          </button>
        </div>
      </div>

      <!-- Deadline Preview -->
      <div class="deadline-preview" *ngIf="taskForm.get('deadline')?.value">
        <lucide-icon name="calendar" size="14"></lucide-icon>
        <span>Due: {{ taskForm.get('deadline')?.value | date:'medium' }}</span>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions" *ngIf="mode === 'create'">
      <h4>Quick Actions</h4>
      <div class="quick-action-buttons">
        <button type="button" class="quick-action-btn" (click)="setHighPriority()">
          <lucide-icon name="zap" size="16"></lucide-icon>
          High Priority
        </button>
        <button type="button" class="quick-action-btn" (click)="taskForm.patchValue({category: 'work'})">
          <lucide-icon name="briefcase" size="16"></lucide-icon>
          Work Task
        </button>
        <button type="button" class="quick-action-btn" (click)="taskForm.patchValue({category: 'personal'})">
          <lucide-icon name="user" size="16"></lucide-icon>
          Personal
        </button>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="onCancel()"
        [disabled]="loading">
        Cancel
      </button>

      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="!isValid || loading">
        <lucide-icon
          [name]="loading ? 'loader-2' : (mode === 'edit' ? 'save' : 'plus')"
          size="16"
          [class.spinning]="loading">
        </lucide-icon>
        {{ submitButtonText }}
      </button>
    </div>

    <!-- Form Status -->
    <div class="form-status" *ngIf="isDirty && !isValid">
      <lucide-icon name="info" size="14"></lucide-icon>
      <span>Please fix the errors above to continue</span>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" *ngIf="loading">
      <div class="loading-spinner"></div>
      <p>{{ mode === 'edit' ? 'Updating task...' : 'Creating task...' }}</p>
    </div>
  </form>
</div>
