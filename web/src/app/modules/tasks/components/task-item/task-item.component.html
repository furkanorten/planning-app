<div class="task-item"
     [class.completed]="task.completed"
     [class.overdue]="isOverdue"
     [class.compact]="compact"
     [class.loading]="loading">

  <!-- Main Content -->
  <div class="task-main" (click)="onToggle()">
    <!-- Checkbox -->
    <div class="task-checkbox">
      <input
        type="checkbox"
        [checked]="task.completed"
        [disabled]="loading"
        (click)="stopPropagation($event)"
        (change)="onToggle()">
      <div class="checkbox-custom">
        <lucide-icon
          name="check"
          size="14"
          *ngIf="task.completed">
        </lucide-icon>
      </div>
    </div>

    <!-- Task Content -->
    <div class="task-content">
      <!-- Title & Description -->
      <div class="task-text">
        <h3 class="task-title" [class.completed]="task.completed">
          {{ task.title }}
        </h3>
        <p class="task-description" *ngIf="task.description && showDetails">
          {{ task.description }}
        </p>
      </div>

      <!-- Task Meta (Category, Priority, Deadline) -->
      <div class="task-meta" *ngIf="showDetails">
        <!-- Category -->
        <span class="task-category" [style.background-color]="categoryInfo.color">
          {{ categoryInfo.label }}
        </span>

        <!-- Priority -->
        <span class="task-priority" [class]="task.priority">
          <lucide-icon [name]="priorityIcon" size="12"></lucide-icon>
          {{ priorityInfo.label }}
        </span>

        <!-- Deadline -->
        <span class="task-deadline"
              *ngIf="task.deadline && deadlineStatus"
              [class]="deadlineStatus">
          <lucide-icon name="calendar" size="12"></lucide-icon>
          {{ deadlineText }}
        </span>

        <!-- Created Date -->
        <span class="task-created" *ngIf="!compact">
          <lucide-icon name="clock" size="12"></lucide-icon>
          {{ formattedCreatedAt }}
        </span>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="task-actions" (click)="stopPropagation($event)">
    <!-- Mobile Actions Toggle -->
    <button class="actions-toggle mobile-only"
            (click)="toggleActions()"
            [class.active]="showActions">
      <lucide-icon name="more-vertical" size="16"></lucide-icon>
    </button>

    <!-- Action Buttons -->
    <div class="action-buttons" [class.show]="showActions">
      <button class="action-btn edit"
              (click)="onEdit()"
              [disabled]="loading"
              title="Edit task">
        <lucide-icon name="edit-2" size="16"></lucide-icon>
        <span class="action-text">Edit</span>
      </button>

      <button class="action-btn delete"
              (click)="onDelete()"
              [disabled]="loading"
              title="Delete task">
        <lucide-icon name="trash-2" size="16"></lucide-icon>
        <span class="action-text">Delete</span>
      </button>

      <button class="action-btn toggle-completion"
              (click)="onToggle()"
              [disabled]="loading"
              [title]="task.completed ? 'Mark as incomplete' : 'Mark as complete'">
        <lucide-icon [name]="task.completed ? 'x' : 'check'" size="16"></lucide-icon>
        <span class="action-text">
          {{ task.completed ? 'Undo' : 'Complete' }}
        </span>
      </button>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="loading">
    <div class="loading-spinner"></div>
  </div>
</div>
